# CookTalk Refactor Plan (Korean)

## North Star
- 손이 바쁜 요리 중, AI가 레시피를 읽어주고 진행도를 추적.
- 유저는 자연어(한국어)로 “다음/이전/다시 설명/타이머 시작/중지” 등을 제어.
- 버튼 없이 지속 음성 상호작용(핫마이크/VAD), 필요 시 타이머 자동 실행.

## 리팩토링 원칙
- 도메인 모델 정리 → 상태관리 일관화 → AI·음성 오케스트레이션 → 화면/UX 개선 → 품질/로그/테스트.
- MVP 우선: 단계 안내 + 타이머 제어 + 진행도 저장.

## Phase 1 — 크리티컬 픽스 & UX 퀵윈
- 팔로잉: 팔로우/언팔로우 동작 복구, 팔로잉 피드 반영 확인.
- 피드: 댓글(작성/수정/삭제/신고) 동작 복구, 책갈피가 “저장됨” 컬렉션에 반영되도록 수정.
- 레시피: “+ 레시피 추가하기” 버튼이 즉시 생성 화면으로 진입(하단 '+' 버튼은 유지)
- 레시피: (추천/내 레시피) 토글 , 리스트/그리드 전환 토글 추가.
- 인기: 오버플로우 버그 수정, 피드형 카드로 변경(그리드 제거), 순위/좋아요 수 표시.
- 언어: 기본 로케일 한국어 적용 및 리소스 점검.

## Phase 2 — 데이터 모델/저장소 정비
- 엔티티
  - Recipe(id, authorId, title, steps[], hashtags[], likeCount, createdAt, ...)
  - RecipeStep(order, text, durationSec?, media?)
  - User(id, nickname, locale, goals[])
  - CookingSession(id, recipeId, userId, currentStep, status, startedAt, completedAt, timers[])
  - Timer(id, label, seconds, startedAt, status)
  - Bookmark(userId, recipeId, createdAt)
  - Follow(followerId, followeeId, createdAt)
- 필드/정책
  - 완료한 요리: CookingSession.completedAt 기반, “완료한 요리” 목록 구성.
  - 진행도: CookingSession.currentStep, status(IN_PROGRESS/PAUSED/COMPLETED).
  - 좋아요/즐겨찾기 분리: 하트(개인 즐겨찾기, 숫자 미노출), 좋아요 수는 피드/인기에만.
  - 해시태그: Recipe.hashtags[] 추가 및 인덱싱.
- 저장소/캐시
  - 오프라인: 세션/타이머 로컬 보존, 앱 재시작 시 복원.

## Phase 3 — AI·음성 오케스트레이션(MVP)
- Orchestrator 서비스
  - 모듈: STT(음성→텍스트), NLU(의도/슬랏), TTS(텍스트→음성), Timer, Progress, Context Memory.
  - 상태: IDLE → READING_STEP → LISTENING → EXECUTING_INTENT.
  - 한국어 기본: STT/TTS/LLM 프롬프트 한국어 최적화.
- 인텐트 정의
  - 진행: 다음/이전/다시 설명/처음부터/현재 단계 요약.
  - 타이머: X분 타이머 시작/정지/일시정지/재개/남은시간.
  - 질의: 재료 대체/팁/주의/온도 변환.
  - 컨트롤: 조용히/느리게/빠르게/중지.
- LLM 연동
  - 프롬프트 템플릿: 단계 지시문, 안전 가이드, 타이머 생성 시 구조화 의도(JSON) 반환.
  - 스트리밍 TTS로 단계 읽어주기, 지연 최소화.
  - 폴백: 간단 명령 로컬 룰 처리(다음/이전/타이머 1분 등).
- 핫마이크(버튼 없이 지속)
  - VAD/웨이크워드 옵션, 프라이버시/배터리 모드 스위치.
  - 세션 시작 시만 활성화, “듣는 중” 미니 UI.

## Phase 4 — 홈 & 추천 리디자인
- “오늘의 추천 레시피” 단일화(중복 섹션 제거).
- 컨텍스트 칩: 날씨/지역/편의점/시간대 등 표시.
- 추천 로직: 컨텍스트 + 선호태그/최근요리 기반, 과도한 추천 축소.
- 이번주 목표: 주간 목표 설정/진척 표시.
- 캐싱/프리패치로 초기 로딩 최적화.

## Phase 5 — 레시피 생성/입력 개선
- 사진→레시피: OCR/비전으로 재료/단계 추출, 수동 보정 UI.
- AI 생성: 제목/요리명만으로 초안 생성 → 편집 후 저장.
- 음성 입력: 단계/재료 구술 입력 → 실시간 텍스트화/구조화.
- 해시태그 입력: 자동완성/최근 추천.
- 유효성 검증: 제목+1개 이상 단계 필수.

## Phase 6 — 소셜·발견 경험
- 팔로잉: 팔로우/언팔로우 후 피드 즉시 갱신, 내 팔로잉 필터.
- 인기: 피드형 카드, 순위 배지, 좋아요 수, 페이지네이션/스켈레톤.
- 완료한 요리 모아보기
  - 마이페이지 “완료한 요리” 탭: 세션 기반 정렬/필터(최근/난이도/소요시간).
  - 레시피 상세에 개인 완료 히스토리/총 횟수 표시.
- 즐겨찾기(인스타 하트)
  - 하트 토글(개인용, 숫자 X), 북마크와 구분.
  - 북마크는 저장함/폴더로 관리(옵션).

## Phase 7 — UI/UX 폴리시
- 레시피 목록: 리스트/그리드 토글, 추천/내 레시피 토글, 정렬/필터.
- 요리 세션: 단계 카드, 진행도 바, 미니 타이머, 음성상태 표시.
- 음성 미니 플레이어: 전역 세션 컨트롤 진입점.
- 오버플로우/줄바꿈/말줄임 처리.

## Phase 8 — 권한/성능/로깅
- 권한: 마이크/알림(타이머)/백그라운드 오디오 플로우 정비.
- 성능: 오프라인 캐시, 이미지 최적화, TTS/STT 지연 모니터링.
- 로깅/분석: 음성 명령 성공률, 타이머 생성률, 단계완료율, 이탈지점.

## Phase 9 — 테스트 전략
- 유닛: Orchestrator 의도 파서, 타이머 매니저, 세션 상태기계.
- 통합: "시작→다음→타이머 생성→완료 기록" 시나리오.
- 위젯: 리스트/그리드 전환, 토글, 레시피 추가 버튼 동작.
- 회귀: 팔로잉, 댓글, 북마크, 인기 카드 레이아웃.

## Phase 10 — 롤아웃
- 플래그로 음성 오케스트레이션 MVP 점진 노출.
- 홈/인기/피드 UI 변경 A/B 점검.
- 크래시/지연 모니터링 후 전체 배포.

## 수용 기준(샘플)
- “완료한 요리” 탭에서 최근 완료 레시피가 시간순으로 보인다.
- 요리 시작 시 TTS 한국어로 1단계를 읽고, “다음/이전/다시” 음성 명령 반응 ≤1초.
- “3분 타이머 시작” 음성 명령 시 타이머 생성·알림·중지/연장 가능.
- “+ 레시피 추가하기” 버튼이 즉시 에디터로 진입한다.
- 인기 탭은 피드형 카드로 렌더링되고 순위/좋아요 수가 표시된다.
- 팔로잉/댓글/책갈피는 서버/스토리지 반영 후 UI에 즉시 갱신된다.

